<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TODO App</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #f0f2f5;
    color: #1a1a2e;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    padding: 40px 16px;
  }

  .app {
    width: 100%;
    max-width: 520px;
  }

  h1 {
    text-align: center;
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 24px;
    color: #16213e;
  }

  .card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 24px rgba(0,0,0,.08);
    padding: 24px;
  }

  /* Input */
  .input-row {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
  }

  .input-row input {
    flex: 1;
    padding: 10px 14px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    outline: none;
    transition: border-color .2s;
  }

  .input-row input:focus { border-color: #4361ee; }

  .input-row button {
    padding: 10px 20px;
    background: #4361ee;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background .2s;
    white-space: nowrap;
  }

  .input-row button:hover { background: #3a56d4; }

  /* Filters */
  .filters {
    display: flex;
    gap: 4px;
    margin-bottom: 16px;
  }

  .filters button {
    flex: 1;
    padding: 8px;
    border: none;
    background: #f0f2f5;
    border-radius: 6px;
    font-size: .875rem;
    cursor: pointer;
    transition: background .2s, color .2s;
    color: #555;
  }

  .filters button.active {
    background: #4361ee;
    color: #fff;
  }

  .filters button:hover:not(.active) { background: #e2e6ea; }

  /* Task list */
  .task-list { list-style: none; }

  .task-list li {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 4px;
    border-bottom: 1px solid #f0f2f5;
    animation: fadeIn .2s ease;
  }

  .task-list li:last-child { border-bottom: none; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(-4px); } to { opacity: 1; transform: translateY(0); } }

  .task-list input[type="checkbox"] {
    width: 20px;
    height: 20px;
    accent-color: #4361ee;
    cursor: pointer;
    flex-shrink: 0;
  }

  .task-list .task-text {
    flex: 1;
    font-size: 1rem;
    word-break: break-word;
    transition: color .2s, text-decoration .2s;
  }

  .task-list li.done .task-text {
    text-decoration: line-through;
    color: #aaa;
  }

  .task-list .delete-btn {
    background: none;
    border: none;
    color: #ccc;
    font-size: 1.25rem;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    transition: color .2s, background .2s;
    line-height: 1;
  }

  .task-list .delete-btn:hover { color: #e74c3c; background: #fdecea; }

  /* Footer */
  .footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 16px;
    font-size: .875rem;
    color: #888;
  }

  .footer button {
    background: none;
    border: none;
    color: #e74c3c;
    font-size: .875rem;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    transition: background .2s;
  }

  .footer button:hover { background: #fdecea; }

  .empty-msg {
    text-align: center;
    padding: 32px 0;
    color: #bbb;
    font-size: .95rem;
  }
</style>
</head>
<body>

<div class="app">
  <h1>TODO</h1>
  <div class="card">
    <div class="input-row">
      <input type="text" id="taskInput" placeholder="新しいタスクを入力…">
      <button onclick="addTask()">追加</button>
    </div>
    <div class="filters">
      <button class="active" data-filter="all">すべて</button>
      <button data-filter="active">未完了</button>
      <button data-filter="completed">完了済み</button>
    </div>
    <ul class="task-list" id="taskList"></ul>
    <div class="footer">
      <span id="remaining"></span>
      <button id="clearCompleted" onclick="clearCompleted()">完了済みを削除</button>
    </div>
  </div>
</div>

<script>
  const STORAGE_KEY = 'todo-app-tasks';
  let tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  let currentFilter = 'all';

  const taskInput = document.getElementById('taskInput');
  const taskList = document.getElementById('taskList');
  const remainingEl = document.getElementById('remaining');
  const clearBtn = document.getElementById('clearCompleted');

  // Filter buttons
  document.querySelector('.filters').addEventListener('click', (e) => {
    if (e.target.tagName !== 'BUTTON') return;
    currentFilter = e.target.dataset.filter;
    document.querySelectorAll('.filters button').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    render();
  });

  // Add task on Enter
  taskInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') addTask();
  });

  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
  }

  function addTask() {
    const text = taskInput.value.trim();
    if (!text) return;
    tasks.push({ id: Date.now(), text, done: false });
    taskInput.value = '';
    save();
    render();
  }

  function toggleTask(id) {
    const task = tasks.find(t => t.id === id);
    if (task) task.done = !task.done;
    save();
    render();
  }

  function deleteTask(id) {
    tasks = tasks.filter(t => t.id !== id);
    save();
    render();
  }

  function clearCompleted() {
    tasks = tasks.filter(t => !t.done);
    save();
    render();
  }

  function render() {
    const filtered = tasks.filter(t => {
      if (currentFilter === 'active') return !t.done;
      if (currentFilter === 'completed') return t.done;
      return true;
    });

    if (filtered.length === 0) {
      taskList.innerHTML = '<li class="empty-msg">タスクがありません</li>';
    } else {
      taskList.innerHTML = filtered.map(t => `
        <li class="${t.done ? 'done' : ''}">
          <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTask(${t.id})">
          <span class="task-text">${escapeHtml(t.text)}</span>
          <button class="delete-btn" onclick="deleteTask(${t.id})" aria-label="削除">&times;</button>
        </li>
      `).join('');
    }

    const remaining = tasks.filter(t => !t.done).length;
    remainingEl.textContent = `残り ${remaining} 件`;
    clearBtn.style.display = tasks.some(t => t.done) ? '' : 'none';
  }

  function escapeHtml(str) {
    const d = document.createElement('div');
    d.textContent = str;
    return d.innerHTML;
  }

  // Initial render
  render();
  taskInput.focus();
</script>

</body>
</html>
